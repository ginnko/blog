---
layout: post
title: react源码学习之首次渲染总结
date: 2020-08-05
tag: 
- react
- 源码
---

前面几篇记录了函数组件首次渲染的流程，这里做一下总结，整理一下重要的节点和概念。


- [JSX到ReactElement的转换流程](./2020-05-26-react源码学习笔记之JSX到ReactElement的转换)：这一步是创建react的输入数据，出现了第一个react内部数据结构————ReactElement
- [首次渲染主要数据结构的构建流程](./2020-07-11-react源码学习之首次渲染主要数据结构的构建)：这一步为root创建了react内部的数据结构————RootFiber和FiberRoot
- [首次渲染更新创建的流程](./2020-07-12-react源码学习之首次渲染的更新过程)：这一步在首次渲染中木有什么大的作用
- [首次渲染更新调度的流程](./2020-07-15-react源码学习之首次渲染调度更新的过程)：这一步为各个元素创建了对应的Fiber对象
- [首次渲染提交给root的流程](./2020-07-31-react源码学习之首次渲染提交root的过程)：这一步根据上面的数据结构创建对应的dom元素，完成层级结构以及最后的渲染进页面

<!-- more -->

这次总结，示例换成类组件。

下面是捋过一次首次渲染之后的粗浅理解。

首次渲染主要经历的过程：

1. 构建基本数据结构

包含：
  - ReactElement
  - root对应的FiberRoot和RootFiber

2. 创建更新

包含：
  - 组件元素对应的react内部数据结构————Fiber
  - 关联生成的各个Fiber形成链表结构
  - workInProgress
  - workInProgress的指向关系

3. 将Fiber对象转换成dom对象，并渲染进root中


感觉还不太明确的概念有：*更新*，*调度*，一边再完整来一遍一遍再看吧。。。

---

### 1. 根据JSX生成ReactElement

- 主要经历两个函数：

  - createElement
  - ReactElement

- 生成的数据结构：

  ```js
  {
    $$typeof: REACT_ELEMENT_TYPE,
    type: type,
    key: key,
    ref: ref,
    props: props,
    _owner: owner,
  }
  ```

reat内部使用上面的ReactElement进一步创建Fiber对象