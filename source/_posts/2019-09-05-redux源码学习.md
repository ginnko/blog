---
layout: post
title: redux源码学习
date: 2019-09-05
tag: 
- redux
---

### 基本概念

#### action

[这篇文章](https://div.io/topic/1309)解释`action`函数是：`对数据来源做萃取工作的函数`。原因是数据来源的多样性，导致数据结构的多样性，`action`函数就是用来过滤'脏数据'的预处理函数。既可以返回新的数据，也可以只提供线索(只有type，没有payload)。

#### reducer

[这篇文章](https://div.io/topic/1309)解释`reducer`函数是：`迎接action函数返回的线索的数据再处理函数`。`reducer`只是一个模式匹配，负责调用在其他地方定义好的数据处理函数。

>reducer 为什么叫 reducer 呢？因为 action 对象各种各样，每种对应某个 case ，但最后都汇总到 state 对象中，从多到一，这是一个减少( reduce )的过程，所以完成这个过程的函数叫 reducer。

---

### 核心函数

#### combineReducers

这个函数存在的意义是为了方便更新属性。核心代码（去掉辅助函数）如下：

```js
export default function combineReducers(reducers) {
  const reducerKeys = Object.keys(reducers)
  const finalReducers = {}
  for (let i = 0; i < reducerKeys.length; i++) {
    const key = reducerKeys[i]
    if (typeof reducers[key] === 'function') {
      finalReducers[key] = reducers[key]
    }
  }
  const finalReducerKeys = Object.keys(finalReducers)

  return function combination(state = {}, action) {
    let hasChanged = false
    const nextState = {}
    for (let i = 0; i < finalReducerKeys.length; i++) {
      const key = finalReducerKeys[i]
      const reducer = finalReducers[key]
      const previousStateForKey = state[key]
      const nextStateForKey = reducer(previousStateForKey, action)

      nextState[key] = nextStateForKey
      hasChanged = hasChanged || nextStateForKey !== previousStateForKey
    }
    hasChanged =
      hasChanged || finalReducerKeys.length !== Object.keys(state).length
    return hasChanged ? nextState : state
  }
}
```

从代码中可以看出，redux的state只能处理一级属性。

---

### 参考资料

1. https://div.io/topic/1309

