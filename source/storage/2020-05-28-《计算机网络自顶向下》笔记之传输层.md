---
layout: post
title: 《计算机网络自顶向下》笔记之传输层(-ing)
date: 2020-05-28
tag: 
- 网络
---

传输层直接向不同主机上运行的应用的peocess提供沟通服务。


<!-- more -->

---

### 传输层(transport layer)和网络层(network layer)的关系

1. 传输层位于网络层之上
2. 网络层提供host之间的逻辑链接
3. 传输层提供host上的应用的process之间的逻辑连接
4. 如果网络层协议不能为host之间交换的传输层封包提供延迟或带宽的保证，传输层协议也不能为process之间交换的message提供延迟或带宽的保证

---

### 术语约定

- segment: TCP或UDP封包
- datagram: 网络层封包

---

### UDP和TCP

1. UDP(User Datagram Protocol): provides an unreliable, connectionless(这个connectionless是指：there is no handshaking between sending and receiving transport-layer entities before sending a segment)service

  提供：
  - transport-layer multiplexing and demultiplexing(extending host-to-host delivery to process-to-process delivery)
  - 完整性检查
  
2. TCP(Transmission Control Protocol): provides a reliable, connection-oriented service
   
  提供：
  - 传输层多路复用和解复用
  - 完整性检查
  - 数据可靠传输
  - congestion control

### demultiplexing和multiplexing

- demultiplexing: The job of deliverying the data in a transport-layer segment to the correct socket
- multiplexing: The job of gathering data chunks at the source host from different sockets, encapsulating each data chunk with header information to create segments, and passing the segments to the network layer

多路复用和解复用处理的场景是一层上的某个协议被位于其上的多个协议使用，HTTP应用和TCP服务刚好属于这种情况，

多路复用和解复用的实现：

- sockets have unique identifier
- each segment have special fields that indicate the socket to which the segment is to be delivered

port number有16位，0~65535，其中0~1023被保留用于默认协议的使用，1024~65535未使用的端口号可用于自行分配

1. Connectionless Multiplexing and Demultiplexing

这种类型的端口号(比如UDP)使用two-tuple来唯一标识：(destination IP address, destination port number)

2. Connection-Oriented Multiplexing and Demultiplexing

这种类型的端口号(比如TCP)使用four-tuple来唯一标识：(source IP address, source port number, destination IP address, destination port number)

---

### web server and TCP

Today's high-performing web servers often use only one process, and create a new thread with a new connection socket for each new client connection

---

### TCP vs UDP

|       |   UDP    |   TCP    |
|  ---  |  ---  |  ---  |
|  time to send data     | UDP添加UDP封包后立即送到网络层      |   TCP先建立连接，有壅挤控制，重送机制    |
|  connection establishment     |  没有建立连接带来的延迟     |  TCP connection-establishment delay in HTTP is an important contributor to the delays associated with downloading web documents     |
|  connection state     | 无状态控制，能支持更多的客户端      | 维护receive and send buffers, congestion-control parameters, sequence and acknowledgment number parameters      |
|  packet header     | 8 bytes      |  20 bytes     |


### UDP封包的结构

<img src="/images/network/udpSegmentStructure.png" width="300" alt="udpSegmentStructure" />

其中，length字段表示数据和UDP header的和